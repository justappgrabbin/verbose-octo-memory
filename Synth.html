<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Paper Prime | Triple Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --paper: #fdfaf3; --ink: #1a202c; }
        body { background: #08080a; color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        
        /* The Living Notebook */
        .notebook-panel { flex: 1; background: var(--paper); padding: 40px; transition: 0.7s; position: relative; }
        .handwritten { font-family: 'Georgia', serif; font-size: 1.5rem; color: var(--ink); outline: none; height: 85%; line-height: 1.6; }
        
        /* Reality Portal */
        .portal { width: 0%; background: #000; transition: 0.7s ease-in-out; display: flex; flex-direction: column; border-left: 2px solid #22c55e; }
        body.active .portal { width: 60%; }
        
        /* Evolution HUD */
        .hud-item { font-size: 10px; font-family: monospace; color: #4ade80; margin-bottom: 5px; }
        .loading-bar { height: 2px; background: #4ade80; width: 0%; transition: width 0.3s; }
        
        iframe { background: white; width: 100%; height: 100%; border: none; }
    </style>
</head>
<body class="flex" id="main-ui">

    <div class="notebook-panel">
        <div id="editor" class="handwritten" contenteditable="true">
Describe the app and the world you want to build...
        </div>
        
        <div class="absolute bottom-10 left-10 flex gap-4">
            <button onclick="evolve()" class="bg-zinc-900 text-white px-8 py-3 rounded-full font-bold hover:bg-black transition border border-white/10">
                ðŸ§¬ EVOLVE REALITY
            </button>
        </div>
    </div>

    <div class="portal">
        <div class="p-4 bg-zinc-900 grid grid-cols-3 gap-4 border-b border-white/5">
            <div>
                <div class="hud-item">CODE_ENGINE: <span id="code-status">IDLE</span></div>
                <div id="code-bar" class="loading-bar"></div>
            </div>
            <div>
                <div class="hud-item">IMAGE_GEN: <span id="img-status">IDLE</span></div>
                <div id="img-bar" class="loading-bar"></div>
            </div>
            <div>
                <div class="hud-item">VOICE_SYNTH: <span id="voice-status">IDLE</span></div>
                <div id="voice-bar" class="loading-bar"></div>
            </div>
        </div>
        <iframe id="output-frame"></iframe>
    </div>

    <audio id="director-voice" hidden></audio>

<script>
    const HF_TOKEN = "hf_xxxxxxxxxxxx"; // Your Hugging Face Token

    async function evolve() {
        const prompt = document.getElementById('editor').innerText;
        document.getElementById('main-ui').classList.add('active');
        
        // Reset Status
        updateHUD('code', 'COMPILING', '30%');
        updateHUD('img', 'DREAMING', '30%');
        updateHUD('voice', 'VOCALIZING', '30%');

        // FIRE ALL THREE MODELS AT ONCE
        try {
            const [codeResult, imageBlob, voiceBlob] = await Promise.all([
                generateCode(prompt),   // Model 1 (e.g., Llama-3-Coder)
                generateImage(prompt),  // Model 2 (e.g., Flux or SDXL)
                generateVoice(prompt)   // Model 3 (e.g., Bark or VITS)
            ]);

            // 1. Inject Code
            const frame = document.getElementById('output-frame');
            frame.srcdoc = codeResult;
            updateHUD('code', 'STABLE', '100%');

            // 2. The Voice Narration
            const voiceUrl = URL.createObjectURL(voiceBlob);
            const audio = document.getElementById('director-voice');
            audio.src = voiceUrl;
            audio.play();
            updateHUD('voice', 'ACTIVE', '100%');

            // 3. Handle Image (Can be sent into the iframe via postMessage)
            const imageUrl = URL.createObjectURL(imageBlob);
            frame.contentWindow.postMessage({ type: 'BG_UPDATE', url: imageUrl }, '*');
            updateHUD('img', 'RENDERED', '100%');

        } catch (err) {
            console.error("Evolution Failed", err);
        }
    }

    function updateHUD(type, status, width) {
        document.getElementById(`${type}-status`).innerText = status;
        document.getElementById(`${type}-bar`).style.width = width;
    }

    // MODEL 1: High-Quality Coding
    async function generateCode(prompt) {
        // Points to a specialized coding model
        const response = await fetch("https://api-inference.huggingface.co/models/meta-llama/Meta-Llama-3-70B-Instruct", {
            headers: { Authorization: `Bearer ${HF_TOKEN}`, "Content-Type": "application/json" },
            method: "POST",
            body: JSON.stringify({ inputs: `Return only high-quality HTML/Tailwind code for: ${prompt}` }),
        });
        const result = await response.json();
        return result[0].generated_text; 
    }

    // MODEL 2: Professional Image Generation
    async function generateImage(prompt) {
        const response = await fetch("https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell", {
            headers: { Authorization: `Bearer ${HF_TOKEN}` },
            method: "POST",
            body: JSON.stringify({ inputs: `High-end app UI background for: ${prompt}` }),
        });
        return await response.blob();
    }

    // MODEL 3: Professional Voice
    async function generateVoice(prompt) {
        const response = await fetch("https://api-inference.huggingface.co/models/facebook/mms-tts-eng", {
            headers: { Authorization: `Bearer ${HF_TOKEN}` },
            method: "POST",
            body: JSON.stringify({ inputs: `I am building your vision now. Creating the ${prompt} world.` }),
        });
        return await response.blob();
    }
</script>
</body>
</html>

